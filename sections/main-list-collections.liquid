{{ 'section-collection-list.css' | asset_url | stylesheet_tag }}

<style>
  /* Section-specific variables */
  #shopify-section-{{ section.id }} {
    --columns-mobile: {{ section.settings.columns_mobile }};
    --columns-desktop: {{ section.settings.columns_desktop }};
  }

  /* Override grid columns */
  #shopify-section-{{ section.id }} .collection-grid {
    grid-template-columns: repeat(var(--columns-mobile), 1fr);
  }

  @media (min-width: 750px) {
    #shopify-section-{{ section.id }} .collection-grid {
      grid-template-columns: repeat(var(--columns-desktop), 1fr);
    }
  }
</style>
{% assign sort_order = section.settings.collection_sort_order %}
{% case sort_order %}
  {% when 'alpha-asc' %}
    {% assign sorted_collections = collections | sort: 'title' %}

  {% when 'alpha-desc' %}
    {% assign sorted_collections = collections | sort: 'title' | reverse %}

  {% else %}
    {% assign sorted_collections = collections %}
{% endcase %}

<div class="page-width">
  <h1>{{ section.settings.heading }}</h1>

  <ul class="collection-grid">
    {% for collection in sorted_collections limit: section.settings.collections_to_show %}
      {% if collection.all_products_count > 0 %}
        <li class="collection-card-wrapper">
          <div class="collection-card">
            <a href="{{ collection.url }}">
              {% if collection.featured_image != blank %}
                {% assign collection_image = collection.featured_image %}
              {% else %}
                {% assign collection_image = collection.products.first.image %}
              {% endif %}
              <img
                src="{{ collection_image | image_url: width: section.settings.image_size }}"
                alt="{{ collection.title | escape }}"
                width="{{ section.settings.image_size }}"
                height="{{ section.settings.image_size }}"
                loading="lazy"
              >
            </a>
            <div class="collection-card-content">
              <h2>
                {{ collection.title }}
              </h2>
              {% if section.settings.show_collection_count %}
                <a
                  href="{{ collection.url }}"
                  style="
                    display:block;
                    margin-top:.25rem;
                    font-size:calc(var(--font-body-scale)*1rem);
                    color:rgb(var(--color-foreground),.7);
                    text-decoration:none;
                  "
                >
                  {{ collection.all_products_count }}
                  {{ collection.all_products_count | pluralize: 'product', 'products' }}
                </a>
              {% endif %}
            </div>
          </div>
        </li>
      {% endif %}
    {% endfor %}
  </ul>
</div>

{% schema %}
{
  "name": "Collections List",
  "tag": "section",
  "class": "section-main-list-collections",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section heading",
      "default": "Collections"
    },
    {
      "type": "number",
      "id": "collections_to_show",
      "label": "Number of collections to show",
      "default": 4
    },
    {
      "type": "checkbox",
      "id": "show_collection_count",
      "label": "Show product count for each collection",
      "default": true
    },
    {
      "type": "select",
      "id": "collection_sort_order",
      "label": "Collection sort order",
      "options": [
        {
          "value": "manual",
          "label": "Manual"
        },
        {
          "value": "best-selling",
          "label": "Best selling"
        },
        {
          "value": "alpha-asc",
          "label": "Alphabetically, A-Z"
        },
        {
          "value": "alpha-desc",
          "label": "Alphabetically, Z-A"
        },
        {
          "value": "created-asc",
          "label": "Date, old to new"
        },
        {
          "value": "created-desc",
          "label": "Date, new to old"
        }
      ],
      "default": "manual"
    },
    {
      "type": "range",
      "id": "image_size",
      "label": "Collection image size",
      "min": 100,
      "max": 500,
      "step": 10,
      "default": 240
    },
    {
      "type": "select",
      "id": "image_shape",
      "label": "Collection image shape",
      "options": [
        {
          "value": "square",
          "label": "Square"
        },
        {
          "value": "rounded",
          "label": "Rounded"
        },
        {
          "value": "circle",
          "label": "Circle"
        }
      ],
      "default": "square"
    },
    {
      "type": "range",
      "id": "columns_mobile",
      "label": "Collections per row (Mobile)",
      "min": 1,
      "max": 4,
      "step": 1,
      "default": 2
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "label": "Collections per row (Desktop)",
      "min": 2,
      "max": 6,
      "step": 1,
      "default": 4
    },
    {
      "type": "text",
      "id": "empty_text",
      "label": "Empty collections text",
      "default": "No collections found"
    }
  ]
}
{% endschema %}
